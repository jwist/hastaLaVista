'use strict';define(['modules/default/defaultcontroller','src/util/api'],function(a,b){'use strict';function c(){}function d(){var f=this.map;this.module.controller.createDataFromEvent('onMapMove','viewport',null,function(){var g=f.getBounds(),h=[,,,,];return h[0]=e(g.getSouthWest()),h[1]=e(g.getNorthWest()),h[2]=e(g.getNorthEast()),h[3]=e(g.getSouthEast()),new DataObject({type:'geojson',value:{type:'Feature',geometry:{type:'Polygon',coordinates:[h]}}})})}function e(f){return[f.lng,f.lat]}return $.extend(!0,c.prototype,a),c.prototype.moduleInformation={name:'Leaflet map',description:'Display a map with objects in it',author:'Michae\xEBl Zasso',date:'11.01.2014',license:'MIT'},c.prototype.references={geojson:{type:['geojson','object'],label:'A GeoJSON object'},viewport:{type:['geojson','object'],label:'Current map view'},position:{label:'Geo coordinates',type:'array'},zoom:{label:'Zoom level',type:'number'},item:{label:'Object on the map',type:'object'},csv:{label:'CSV with latitude and longitude columns',type:'string'},kml:{label:'KML',type:'string'},gpx:{label:'GPX',type:'string'},wkt:{label:'WKT',type:'string'},topojson:{label:'TopoJSON'},point:{label:'A point (object with latitude and longitude)',type:'array'}},c.prototype.events={onMapMove:{label:'The map has moved',refAction:['position'],refVariable:['viewport']},onZoomChange:{label:'The zoom level has changed',refAction:['zoom']},onHoverElement:{label:'Hovers an object',refVariable:['item']},onClickElement:{label:'Click an object',refVariable:['item']}},c.prototype.variablesIn=['geojson','csv','kml','gpx','wkt','topojson','position','point'],c.prototype.actionsIn={position:'Move the map',zoom:'Change zoom'},c.prototype.configurationStructure=function(){return{groups:{group:{options:{title:'Map',type:'list'},fields:{maptiles:{type:'combo',title:'Base tile source',options:[{title:'OpenStreetMap',key:'osm'},{title:'HikeBike',key:'hb'}],default:'osm'},mapcenter:{type:'text',title:'Default center'},mapzoom:{type:'slider',title:'Default zoom',min:0,max:19,step:1,default:'10'},autofit:{type:'combo',title:'Autofit map',options:[{title:'No fit',key:'nofit'},{title:'Fit around everything',key:'all'},{title:'Fit around current variable',key:'var'}],default:'nofit'}}},markers:{options:{title:'Markers',type:'list',multiple:!1},fields:{markerjpath:{type:'combo',title:'Marker JPath',options:this.module.model.getjPath('item')},markerkind:{type:'combo',title:'Default marker kind',options:[{title:'Square',key:'square'},{title:'Circle',key:'circle'},{title:'Image',key:'image'}],default:'image'},markercolor:{type:'color',title:'Default marker color',default:'rgba(0,51,255,0.5)'},markersize:{type:'text',title:'Default marker size',default:'30'}}}}}},c.prototype.configFunctions={mapcenter:function(g){var h=g.split(',');return[parseFloat(h[0]),parseFloat(h[1])]}},c.prototype.configAliases={mapcenter:['groups','group',0,'mapcenter',0],mapzoom:['groups','group',0,'mapzoom',0],maptiles:['groups','group',0,'maptiles',0],autofit:['groups','group',0,'autofit',0],markerjpath:['groups','markers',0,'markerjpath',0],markerkind:['groups','markers',0,'markerkind',0],markercolor:['groups','markers',0,'markercolor',0],markersize:['groups','markers',0,'markersize',0]},c.prototype.hoverElement=function(f){this.createDataFromEvent('onHoverElement','item',f),b.highlight(f,1)},c.prototype.clickElement=function(f){this.createDataFromEvent('onClickElement','item',f)},c.prototype.moveAction=function(){var f=this.map.getCenter();this.module.controller.sendActionFromEvent('onMapMove','position',[f.lat,f.lng]),d.call(this)},c.prototype.zoomAction=function(){this.module.controller.sendActionFromEvent('onZoomChange','zoom',this.map.getZoom()),d.call(this)},c});
